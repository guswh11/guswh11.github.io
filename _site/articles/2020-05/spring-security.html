<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="설명">
    <meta name="keywords"  content="黄玄, Hux黄玄, Hux, 鬼栈, huxpro, @huxpro, 黄玄的博客, Hux Blog, 博客, 个人网站, 互联网, Web, JavaScript, 前端, 设计">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Spring security에 대해 - 탭에 뜰 말">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="Spring security
Spring security(스프링 시큐리티)란
스프링 시큐리티는 스프링 기반의 어플리케이션의 보안(인증과 권한)을 담당하는 프레임워크로,
인증과 권한 제어에 필요한 필터의 모음이다.
필터를 기반으로 권한에 따른 접근 제어 기능, 패스워드 암호화 등의 기능을 지원한다. 
만약 스프링 시큐리티를 사용하지 않는다면 개발자가 보...">
    
    <meta property="article:published_time" content="2020-05-17T00:00:00Z">
    
    
    
    <meta property="article:tag" content="Spring">
    
    <meta property="article:tag" content="Spring Security">
    
    
    <meta property="og:image" content="http://localhost:4000/img/avatar-round.png">
    <meta property="og:url" content="http://localhost:4000/articles/2020-05/spring-security">
    <meta property="og:site_name" content="탭에 뜰 말">
    
    <title>Spring security에 대해 - 탭에 뜰 말</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/articles/2020-05/spring-security">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">블로그 이름</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    
                    
                    
                    <li>
                        <a href="/about">About</a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="/archive">Archive</a>
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        <a href="/categories/">Categories</a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    <li>
                        <a href="/tags/">Tags</a>
                    </li>
                    
                    
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/bg-3.jpg" width="0" height="0"> -->

<!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/bg-3.jpg');
        background: ;
    }

    
</style>

<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=Spring" title="Spring">Spring</a>
                        
                        <a class="tag" href="/archive/?tag=Spring+Security" title="Spring Security">Spring Security</a>
                        
                    </div>
                    <h1>Spring security에 대해</h1>
                    
                    <h2 class="subheading"></h2>
                    <span class="meta">Posted by 블로그 이름 on May 17, 2020</span>
                </div>
            </div>
        </div>
    </div>
</header>






<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<h1 id="spring-security">Spring security</h1>
<h2 id="spring-security스프링-시큐리티란">Spring security(스프링 시큐리티)란</h2>
<p>스프링 시큐리티는 스프링 기반의 어플리케이션의 보안(인증과 권한)을 담당하는 프레임워크로,
인증과 권한 제어에 필요한 필터의 모음이다.
필터를 기반으로 권한에 따른 접근 제어 기능, 패스워드 암호화 등의 기능을 지원한다. 
만약 스프링 시큐리티를 사용하지 않는다면 개발자가 보안 관련 로직을 직접 작성해야 할 것이다.</p>
<blockquote>
  <p>웹 클라이언트의 요청에 대해서 필요한 사전 작업이 있을 경우에 필터를 사용</p>
</blockquote>

<h4 id="보안-관련-용어">보안 관련 용어</h4>
<ul>
  <li><strong>접근 주체(Principal)</strong> : 보호된 대상에 접근하는 유저</li>
  <li><strong>인증(Authenticate)</strong> : 입력받은 정보와 사용자 정보를 비교해서 신원을 확인하는 것(ex. 로그인)
    <ul>
      <li>애플리케이션의 작업을 수행할 수 있는 주체임을 증명</li>
      <li>코드에서의 Authentication: 인증 과정에서 사용되는 핵심 객체</li>
      <li>스프링 시큐리티는 기본적으로 HTTP 기본 인증 방식으로 동작</li>
    </ul>
  </li>
  <li><strong>인가(Authorization)</strong> : 인증 과정을 통해 사용자를 식별한 후 사용자가 가진 권한을 확인하여 권한에 맞게 접근을 허용하는 것
    <ul>
      <li>스프링 시큐리티에서는 권한 관리가 Role(접속한 사용자가 사이트에서 수행하는 역할) 기반으로 이루어진다.</li>
    </ul>
  </li>
</ul>

<h2 id="스프링-시큐리티의-구조">스프링 시큐리티의 구조</h2>
<h3 id="인증-관련-구조">인증 관련 구조</h3>
<p><img src="spring-security-architecture.png" alt="authentication-architecture" /></p>

<p><strong>spring security는 세션-쿠키방식으로 인증한다.</strong></p>
<ol>
  <li>유저가 로그인을 시도 (http request)</li>
  <li>AuthenticationFilter 에서부터 위와같이 user DB까지 타고 들어감</li>
  <li>DB에 있는 유저라면 UserDetails 로 꺼내서 유저의 session 생성</li>
  <li>spring security의 인메모리 세션저장소인 SecurityContextHolder 에 저장</li>
  <li>유저에게 session ID와 함께 응답을 내려줌</li>
  <li>이후 요청에서는 요청쿠키에서 JSESSIONID를 검증 후, 유효하면 Authentication를 쥐어준다.</li>
</ol>

<h3 id="스프링-시큐리티의-filter">스프링 시큐리티의 filter</h3>
<p><img src="spring-security-filter.png" alt="filter" /></p>

<ul>
  <li><strong>SecurityContextPersistenceFilter</strong> : SecurityContextRepository에서 SecurityContext를 가져오거나 저장하는 역할을 한다. (SecurityContext는 밑에)</li>
  <li><strong>LogoutFilter</strong> : 설정된 로그아웃 URL로 오는 요청을 감시하며, 해당 유저를 로그아웃 처리</li>
  <li><strong>(UsernamePassword)AuthenticationFilter</strong> : (아이디와 비밀번호를 사용하는 form 기반 인증) 설정된 로그인 URL로 오는 요청을 감시하며, 유저 인증 처리
    <ul>
      <li>AuthenticationManager를 통한 인증 실행</li>
      <li>인증 성공 시, 얻은 Authentication 객체를 SecurityContext에 저장 후 AuthenticationSuccessHandler 실행</li>
      <li>인증 실패 시, AuthenticationFailureHandler 실행</li>
    </ul>
  </li>
  <li><strong>DefaultLoginPageGeneratingFilter</strong> : 인증을 위한 로그인폼 URL을 감시한다.</li>
  <li><strong>BasicAuthenticationFilter</strong> : HTTP 기본 인증 헤더를 감시하여 처리한다.</li>
  <li><strong>RequestCacheAwareFilter</strong> : 로그인 성공 후, 원래 요청 정보를 재구성하기 위해 사용된다.</li>
  <li><strong>SecurityContextHolderAwareRequestFilter</strong> : HttpServletRequestWrapper를 상속한 SecurityContextHolderAwareRequestWapper 클래스로 HttpServletRequest 정보를 감싼다.
    <ul>
      <li>SecurityContextHolderAwareRequestWrapper 클래스는 필터 체인상의 다음 필터들에게 부가정보를 제공한다.</li>
    </ul>
  </li>
  <li><strong>AnonymousAuthenticationFilter</strong> : 이 필터가 호출되는 시점까지 사용자 정보가 인증되지 않았다면 인증토큰에 사용자가 익명 사용자로 나타난다.</li>
  <li><strong>SessionManagementFilter</strong> : 이 필터는 인증된 사용자와 관련된 모든 세션을 추적한다.</li>
  <li><strong>ExceptionTranslationFilter</strong> : 이 필터는 보호된 요청을 처리하는 중에 발생할 수 있는 예외를 위임하거나 전달하는 역할을 한다.</li>
  <li><strong>FilterSecurityInterceptor</strong> : 이 필터는 AccessDecisionManager 로 권한부여 처리를 위임함으로써 접근 제어 결정을 쉽게해준다.</li>
</ul>

<h3 id="authentication">Authentication</h3>
<p>모든 접근 주체(유저)는 Authentication을 생성한다. 
이것은 SecurityContext 에 보관되고 사용된다. 
즉 security의 세션들은 내부 메모리(SecurityContextHolder)에 쌓고 꺼내쓰는 것이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Authentication</span> <span class="kd">extends</span> <span class="nc">Principal</span><span class="o">,</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="nf">getAuthorities</span><span class="o">();</span> <span class="c1">// Authentication 저장소에 의해 인증된 사용자의 권한 목록</span>
    <span class="nc">Object</span> <span class="nf">getCredentials</span><span class="o">();</span> <span class="c1">// 주로 비밀번호</span>
    <span class="nc">Object</span> <span class="nf">getDetails</span><span class="o">();</span> <span class="c1">// 사용자 상세정보</span>
    <span class="nc">Object</span> <span class="nf">getPrincipal</span><span class="o">();</span> <span class="c1">// 주로 ID</span>
    <span class="kt">boolean</span> <span class="nf">isAuthenticated</span><span class="o">();</span> <span class="c1">//인증 여부</span>
    <span class="kt">void</span> <span class="nf">setAuthenticated</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">isAuthenticated</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IllegalArgumentException</span><span class="o">;</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="authenticationmanager">AuthenticationManager</h3>
<p><img src="authentication-manager.png" alt="AuthenticationManager" /></p>

<p>유저의 요청 내에 담긴 Authentication를 AuthenticationManager 에 넘겨주고, AuthenticationManager 를 구현한 ProviderManager가 처리한다. 정확히는 ProviderManager 는 private <code class="highlighter-rouge">List&lt;AuthenticationProvider&gt; providers;</code> 로 여러 AuthenticationProvider를 가질 수 있는데, 이 친구들이 처리를 해서 Authentication 를 반환해준다. (실패하면 예외던짐)</p>
<ul>
  <li><strong>AuthenticationManager</strong> : 인증요청을 받고 Authentication를 채운다.</li>
  <li><strong>AuthenticationProvider</strong> : 실제 인증이 일어나며, 성공하면 Authentication.isAuthenticated = true 를 한다.</li>
</ul>

<h3 id="reference">Reference</h3>
<p><a href="https://docs.spring.io/spring-security/site/docs/4.2.7.RELEASE/reference/htmlsingle/#getting-started">https://docs.spring.io/spring-security/site/docs/4.2.7.RELEASE/reference/htmlsingle/#getting-started</a>
<a href="https://sjh836.tistory.com/165">https://sjh836.tistory.com/165</a>
<a href="https://coding-start.tistory.com/153">https://coding-start.tistory.com/153</a></p>


                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/articles/2020-05/about-npm" data-toggle="tooltip" data-placement="top" title="npm에 대해">
                        Previous<br>
                        <span>npm에 대해</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/articles/2020-05/spring-security-01" data-toggle="tooltip" data-placement="top" title="Spring security 설정 방법">
                        Next<br>
                        <span>Spring security 설정 방법</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

                
            </div>  

    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        
        
        
                <a data-sort="0008" 
                    href="/archive/?tag=Spring+Boot"
                    title="Spring Boot"
                    rel="7">Spring Boot</a>
        
                <a data-sort="0011" 
                    href="/archive/?tag=Database"
                    title="Database"
                    rel="4">Database</a>
        
                <a data-sort="0012" 
                    href="/archive/?tag=JPA"
                    title="JPA"
                    rel="3">JPA</a>
        
                <a data-sort="0012" 
                    href="/archive/?tag=Spring+Security"
                    title="Spring Security"
                    rel="3">Spring Security</a>
        
                <a data-sort="0013" 
                    href="/archive/?tag=Spring"
                    title="Spring"
                    rel="2">Spring</a>
        
                <a data-sort="0013" 
                    href="/archive/?tag=Web"
                    title="Web"
                    rel="2">Web</a>
    </div>
</section>


                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->






<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "hyunjin";
    var disqus_identifier = "/articles/2020-05/spring-security";
    var disqus_url = "http://localhost:4000/articles/2020-05/spring-security";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  
  
  
  
  <li>
    <a target="_blank" href="https://github.com/guswh11">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; 블로그 이름 2020
                    <br>
                    Powered by <a href="http://huangxuan.me">Hux Blog</a> |
                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="100px"
                        height="20px"
                        src="https://ghbtns.com/github-btn.html?user=huxpro&repo=huxpro.github.io&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->







<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function () {
        var $nav = document.querySelector("nav");
        if ($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->



<!-- Side Catalog -->



<!-- Multi-Lingual -->



<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
