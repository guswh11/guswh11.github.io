---
layout: post
title: "프로세스 스케줄링, 문맥 교환(Context Switch)"
categories: [OS]
comments: true
tags:
  - OS
  - Process
---

## 프로세스 스케줄링(Process Scheduling)
스케줄링이란 메모리에 있는 준비(ready) 상태의 프로세스들 사이의 우선 순위를 관리하고, 이 중 하나를 선택해 CPU 자원을 할당하는 것이다.<br>스케줄링은 처리율과 CPU 이용률을 증가시키고, 오버헤드/응답시간/반환시간/대기시간을 최소화시키기 위한 기법이다. 

#### 스케줄링 큐(Scheduling Queues)
- 잡 큐: 시스템 안의 모든 프로세스로 구성됨
- 준비완료 큐(ready queue): 프로세스들이 준비완료 상태에서 실행을 대기함
    - 일반적으로 연결 리스트의 형태 
    - 큐의 헤더는 리스트의 첫 번째와 마지막 PCB를 가리키는 포인터를 포함
    - 각 PCB는 준비완료 큐에 있는 다음 프로세스를 가리키는 포인터 필드를 가짐
- 장치 큐(device queue): 특정 입출력 장치를 대기하는 프로세스들의 리스트
    - 각 장치는 자신의 장치 큐를 가짐

새로운 프로세스는 준비완료 큐에 놓인다.<br>프로세스에 CPU가 할당되어 실행되면, 다음 사건들 중 하나가 발생할 수 있다. 
- 프로세스가 입출력을 요청하여 입출력 큐에 넣어질 수 있다. 
- 프로세스가 새로운 서브프로세스를 생성하고 그 프로세스의 종료를 기다릴 수 있다. 
- 프로세스가 인터럽트의 결과에 따라 강제로 CPU로부터 제거되어 준비완료 큐에 다시 놓일 수 있다. 

프로세스는 종료될 때까지 이 주기를 계속하며, 종료되면 모든 큐에서 삭제되고 PCB와 자원을 반납한다. 

![process scheduling](process-scheduling.jpeg)

#### 스케줄러(Schedulers)
프로세스 선택 절차(스케줄링)은 스케줄러에 의해 실행된다. 

**장기 스케줄러(잡 스케줄러)**
- 프로세스들을 선택해 실행하기 위해 메모리로 적재
- 메모리의 사용 가능 공간 및 자원을 확인
- 새로운 프로세스를 생성하거나 프로세스가 시스템을 떠날 때만 호출됨
- 실행 빈도 적음(수 분)

**단기 스케줄러(CPU 스케줄러)**
- 실행 준비가 완료된 프로세스들 중 하나를 선택해 CPU를 할당
- 프로세스의 실행상태를 대기 혹은 준비 상태로 변화시킴 
- 실행 간격 짧음(백 밀리초) -> 실행 속도 빠름 

**중기 스케줄러**
- 프로세스 스와핑 수행
    - 메모리에서 프로세스를 제거해 다중 프로그래밍의 정도를 완화
    - 나중에 다시 프로세스를 메모리로 불러와서 중단되었던 지점부터 실행
- 프로세스 혼잡 상태 개선, 메모리를 비울 때 필요

#### 문맥 교환(Context Swtich)
Context switch는 CPU를 다른 프로세스에게 할당하기 위해 현재 프로세스의 상태를 PC에 저장하고 다른 프로세스의 저장된 상태를 복구하는 작업이다. 

- context switch 동안 시스템은 아무 일도 하지 못함 
    - context switch 시간은 오버헤드
    - 속도는 메모리의 속도, 복사되어야 하는 레지스터의 수, 레지스터 명령어 등에 좌우됨
    - 주로 수 밀리초 정도
- context switch 시간은 하드웨어의 지원에 크게 좌우됨 
    - 레지스터 수, 활성 프로세스가 레지스터 수보다 많은지(많다면 레지스터 값을 메모리로 복사해야)
    - 메모리 관리 기법 등

