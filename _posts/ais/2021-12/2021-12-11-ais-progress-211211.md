---
layout: post
title: "211211 AIS 진행상황"
categories: [ais]
comments: true
tags:
  - AIS
---
### 1211 개선사항

**수정사항**<br>
1. cluster clear 시 절댓값 계산 제거
	- 중간에 3일 이전의 과거데이터가 유입되는 경우, 클러스터 복합객체가 지워져 클러스터가 분화되는 현상 존재
2. imo_no null 검사 추가
3. class A 내 mmsi/imo_no map 분리
	- <key, clusteredVO> 형태의 맵을 mmsi/imo_no 간에 공유해도 상관 없다고 생각했지만(mmsi/imo_no 형식이 다르므로), 제대로 정제되지 않는 데이터가 존재할 경우 두 key가 같은 값을 가지는 경우가 있을 수도 있겠다고 생각됨
	- map에 sync를 거는 코드가 존재하므로 분리하는 것이 성능 상 좋아보임
	
**운영방안에 대한 의견**<br>
1. 실제로 이렇게 오류가 많은 것인지?
    - 경로가 왔다갔다해서 무지개 형태로 나타나서 많아보이는 것이지, 클러스터링 진행 결과는 경로 2개 정도로 좁혀질 가능성 있음<br>( 위 같이 무지개 형태로 나타나는 것보다 산발적인 점 형태로 나타나는 오류가 더 문제라고 봄 )
    - 실제로 8773237, 9527037에 대한 결과는 모두 경로 2개로 나타남
    - 첫번째 스크린샷 (8773237)의 경우, 흰 점이 배라고 가정했을 때 인접한 위치데이터가 연속적으로 나타난다면 한 경로로 합쳐질 것임

2. 오류가 많다면 줄일수 있는 방법이 있는지? - 민감도 조절
    - 메인 이동경로 추출을 원한다면, 에러 판별 포인트 수를 높여 민감도를 낮추는 것이 좋을 것 같다.<br>(현재 1으로, 2개 이상의 튀는 데이터 존재 시 에러로 판별)
    - 클러스터 분화는 변함 없겠지만, 코드로 필터링 할 경우 나타나는 메인 이동 경로의 수가 더 줄어들 것

**데이터 검증 결과**<br>
imo_no: 8773237<br>
2021-12-05 14:39:56 ~ 2021-12-09 12:10:00, 총 531 데이터

분리 전<br>
![8773237-before](8773237-before.png)

분리 후<br>
![8773237-after](8773237-after.png)

imo_no: 9527037<br>
2021-12-05 16:13:14 ~ 2021-12-09 12:27:30, 총 483 데이터 

분리 전<br>
![9527037-before](9527037-before.png)

분리 후<br>
![9527037-after-1](9527037-after-1.png)
![9527037-after-2](9527037-after-2.png)

클러스터 분리 요인:<br>
![9527037-data](9527037-data.png)

timestamp 는 위치데이터 수집 일시, 위 결과는 처리 순서대로 나열됨<br>
중간에 3일 이전 과거데이터가 처리됨 -> cluster clear 로직에 따라 이전 클러스터(_1, _2)가 제거되고, 275번 데이터는 시간꼬임으로 인해 처리되지 않음<br>
-> cluster clear 로직에 아직 절대값 계산이 들어가있기 때문